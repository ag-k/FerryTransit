---
inclusion: always
---

# 開発標準・コーディング規約

## 基本原則

### 1. 言語とコミュニケーション

- **開発言語**: 日本語でのコミュニケーションを基本とする
- **コメント**: 複雑なロジックには日本語でコメントを記述
- **変数名**: 英語を使用するが、意味が明確になるよう配慮

### 2. TypeScript 規約

- **strict mode**: 必ず有効にし、`any`型の使用を避ける
- **型定義**: `src/types/`ディレクトリに適切に整理
- **インターフェース**: 明確な命名規則に従う（例: `FerryRoute`, `TimetableData`）

### 3. Vue.js / Nuxt3 規約

- **Composition API**: 新規コンポーネントは Composition API を使用
- **単一ファイルコンポーネント**: `<script setup>`構文を推奨
- **プロップス**: TypeScript インターフェースで型定義
- **イベント**: `defineEmits`を使用して型安全に定義

## ファイル・ディレクトリ構造

### コンポーネント命名

```
src/components/
├── common/          # 共通コンポーネント
├── admin/           # 管理画面専用
├── favorites/       # お気に入り機能
├── news/            # お知らせ機能
└── ui/              # UIコンポーネント
```

### ページ構成

```
src/pages/
├── admin/           # 管理画面（認証必須）
├── news/            # お知らせページ
└── [その他].vue     # ユーザー向けページ
```

## スタイリング規約

### Tailwind CSS

- **ユーティリティファースト**: Tailwind クラスを優先使用
- **カスタム CSS**: 必要最小限に留める
- **レスポンシブ**: モバイルファーストで設計
- **ダークモード**: `dark:`プレフィックスで対応

### SCSS 使用時

- **BEM 記法**: Block\_\_Element--Modifier を基本とする
- **ネスト**: 3 階層以下に制限
- **変数**: CSS Custom Properties を優先

## 状態管理（Pinia）

### ストア構成

```
src/stores/
├── admin.ts         # 管理機能
├── auth.ts          # 認証状態
├── ferry.ts         # フェリーデータ
├── favorite.ts      # お気に入り
└── ui.ts            # UI状態
```

### ストア設計原則

- **単一責任**: 1 つのストアは 1 つの責任領域
- **型安全**: 全ての状態とアクションに型定義
- **永続化**: 必要に応じて`localStorage`と連携

## 国際化（i18n）

### キー命名規則

```json
{
  "pages": {
    "timetable": {
      "title": "時刻表",
      "search": "検索"
    }
  },
  "components": {
    "navigation": {
      "home": "ホーム"
    }
  }
}
```

### 使用方法

```vue
<template>
  <h1>{{ $t("pages.timetable.title") }}</h1>
</template>
```

## テスト規約

### ユニットテスト

- **ファイル配置**: `__tests__`ディレクトリまたは`.test.ts`サフィックス
- **命名**: `describe`と`it`は日本語で記述可能
- **カバレッジ**: 新機能は必ずテストを作成

### テスト例

```typescript
describe("FerryRoute コンポーネント", () => {
  it("正しい料金が表示される", () => {
    // テストロジック
  });
});
```

## Firebase 統合

### Firestore

- **コレクション名**: 英語の複数形（例: `timetables`, `fares`）
- **ドキュメント ID**: 意味のある文字列を使用
- **セキュリティルール**: 最小権限の原則

### Authentication

- **管理者権限**: カスタムクレームで管理
- **セッション管理**: 適切なタイムアウト設定

## エラーハンドリング

### エラー表示

- **ユーザー向け**: 日本語での分かりやすいメッセージ
- **開発者向け**: 詳細なログ出力
- **国際化**: エラーメッセージも i18n 対応

### ログ出力

```typescript
// 開発環境
console.error("エラー詳細:", error);

// 本番環境
// Firebase Analyticsやログサービスに送信
```

## パフォーマンス

### 最適化指針

- **遅延読み込み**: 大きなコンポーネントは動的インポート
- **画像最適化**: WebP 形式を優先、適切なサイズ設定
- **バンドル分割**: ページ単位でのコード分割

### 監視項目

- **Core Web Vitals**: LCP, FID, CLS
- **Lighthouse スコア**: 90 点以上を目標
- **バンドルサイズ**: 定期的な監視と最適化

## セキュリティ

### 基本方針

- **XSS 対策**: ユーザー入力の適切なエスケープ
- **CSRF 対策**: Nuxt の標準機能を活用
- **認証**: Firebase Authentication の適切な使用

### 管理画面

- **権限チェック**: ページレベルと API レベルで実装
- **操作ログ**: 重要な操作は全て記録
- **確認ダイアログ**: 危険な操作には確認を必須化
