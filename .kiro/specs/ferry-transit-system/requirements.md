# Requirements Document

## Introduction

隠岐航路案内は、島根県隠岐諸島の包括的なフェリー時刻表・航路情報システムです。本土と隠岐諸島間を移動する旅行者に対して、リアルタイムのフェリースケジュール、経路計画、料金計算、運航状況情報を提供します。アプリケーションは日本語と英語の両方をサポートし、一般ユーザーと管理者の両方にサービスを提供します。

## Requirements

### Requirement 1: 多言語対応フェリー時刻表表示

**User Story:** 旅行者として、日本語と英語の両方でフェリー時刻表を閲覧したい。言語の好みに関係なく旅行計画を立てられるようにするため。

#### Acceptance Criteria

1. WHEN ユーザーが時刻表ページにアクセスしたとき THEN システムはユーザーが選択した言語（日本語または英語）でフェリースケジュールを表示すること
2. WHEN ユーザーが言語を切り替えたとき THEN システムは港名、船名、ステータスメッセージを含むすべての時刻表情報を更新すること
3. WHEN 時刻表を表示するとき THEN システムは各航路の出発時刻、到着時刻、船名、運航状況を表示すること
4. WHEN 時刻表データが利用できないとき THEN システムは選択された言語で適切なメッセージを表示すること

### Requirement 2: インタラクティブな経路計画・検索

**User Story:** 旅行者として、特定の港間の特定日付のフェリー航路を検索したい。自分の旅行に最適な選択肢を見つけるため。

#### Acceptance Criteria

1. WHEN ユーザーが出発港と到着港を選択したとき THEN システムは利用可能なすべての直行便と乗継便を表示すること
2. WHEN ユーザーが旅行日を選択したとき THEN システムはその日付に有効な航路のみを表示するよう時刻表をフィルタリングすること
3. WHEN 複数の航路選択肢が存在するとき THEN システムは直行便と乗継便の両方を接続詳細とともに表示すること
4. WHEN ユーザーが航路選択を逆転させたとき THEN システムは出発港と到着港を入れ替えて結果を更新すること
5. WHEN 航路データが読み込み中のとき THEN システムは読み込みインジケーターを表示すること

### Requirement 3: リアルタイム運航状況統合

**User Story:** 旅行者として、フェリーサービスのリアルタイム運航状況とアラートを確認したい。遅延、欠航、スケジュール変更について情報を得るため。

#### Acceptance Criteria

1. WHEN フェリーサービスに運航アラートがあるとき THEN システムはステータスインジケーター（通常、遅延、欠航、スケジュール変更）を表示すること
2. WHEN フェリーが欠航したとき THEN システムは影響を受ける便を明確にマークし、利用可能な場合は代替選択肢を提供すること
3. WHEN 天候関連の運航障害があるとき THEN システムは波高情報とサービスへの影響を表示すること
4. WHEN 運航状況が更新されたとき THEN システムは 15 分以内に表示を更新すること
5. WHEN オフライン時 THEN システムは適切なオフラインインジケーターとともにキャッシュされた状況情報を表示すること

### Requirement 4: 包括的な料金計算

**User Story:** 旅行者として、繁忙期料金や利用可能な割引を含む正確な料金情報を確認したい。旅行の予算を立てるため。

#### Acceptance Criteria

1. WHEN 航路結果を表示するとき THEN システムは各航路区間の料金情報を計算して表示すること
2. WHEN 旅行日が繁忙期に該当するとき THEN システムは自動的に繁忙期料金を適用すること
3. WHEN 適用可能な割引が利用できるとき THEN システムは割引選択肢（住民割引、団体割引など）を表示すること
4. WHEN 航路に乗継が含まれるとき THEN システムはすべての区間を含む総料金を計算すること
5. WHEN 料金データが利用できないとき THEN システムは運航会社に料金情報の確認が必要であることを示すこと

### Requirement 5: パーソナライズされたユーザー体験

**User Story:** 頻繁に利用する旅行者として、お気に入りの航路を保存し、検索履歴にアクセスしたい。よく使用する旅行情報に素早くアクセスするため。

#### Acceptance Criteria

1. WHEN ユーザーが航路をお気に入りにマークしたとき THEN システムはこれらの設定をローカルに保存し、目立つように表示すること
2. WHEN ユーザーが検索を実行したとき THEN システムは以前のクエリへの素早いアクセスのために検索履歴を維持すること
3. WHEN ユーザーがアプリケーションに戻ったとき THEN システムは最後に選択された出発港と到着港を復元すること
4. WHEN ユーザーがダークモードを有効にしたとき THEN システムはすべてのページで一貫してダークテーマを適用すること
5. WHEN ユーザーのデバイスがオフラインのとき THEN システムはキャッシュされたお気に入り航路と最近の検索へのアクセスを提供すること

### Requirement 6: 管理者コンテンツ管理

**User Story:** 管理者として、時刻表データ、料金、アラート、ニュースコンテンツを管理したい。システムを正確な情報で最新に保つため。

#### Acceptance Criteria

1. WHEN 管理者がログインしたとき THEN システムは Firebase Authentication を使用して認証し、管理者権限を確認すること
2. WHEN 時刻表を管理するとき THEN システムは CSV インポート/エクスポートと検証付きの個別便編集を許可すること
3. WHEN アラートを作成するとき THEN システムはアラートタイプ、影響を受ける航路、多言語メッセージの設定を許可すること
4. WHEN ニュースを公開するとき THEN システムは下書き/公開状態、スケジューリング、多言語コンテンツをサポートすること
5. WHEN 変更を行うとき THEN システムはタイムスタンプとユーザー識別を含むすべての管理者アクションをログに記録すること

### Requirement 7: データ公開・配信

**User Story:** 管理者として、更新されたデータを公開システムに公開したい。ユーザーが最新の情報を受け取れるようにするため。

#### Acceptance Criteria

1. WHEN データを公開するとき THEN システムは承認されたデータを JSON 形式で Firebase Storage にエクスポートすること
2. WHEN データが公開されたとき THEN システムは 5 分以内に公開エンドポイントを更新すること
3. WHEN 公開が失敗したとき THEN システムはエラー詳細を提供し、以前の公開バージョンを維持すること
4. WHEN データが公開されたとき THEN システムはタイムスタンプ付きのバックアップコピーを作成すること
5. WHEN データを復元するとき THEN システムは管理者が以前の公開バージョンから復元することを許可すること

### Requirement 8: モバイル対応プログレッシブ Web アプリケーション

**User Story:** モバイルユーザーとして、ネイティブアプリのような体験でスマートフォンでフェリー情報にアクセスしたい。旅行中に便利にサービスを利用するため。

#### Acceptance Criteria

1. WHEN モバイルデバイスでアクセスするとき THEN システムは主要機能を含む下部ナビゲーションバーを表示すること
2. WHEN アプリケーションが読み込まれるとき THEN システムはオフライン機能を持つプログレッシブ Web アプリとして機能すること
3. WHEN ネットワークが利用できないとき THEN システムは基本機能のためにキャッシュされた時刻表と料金データを提供すること
4. WHEN タッチデバイスを使用するとき THEN システムは適切なタッチターゲットとジェスチャーサポートを提供すること
5. WHEN 画面サイズが変更されるとき THEN システムはモバイルからデスクトップまでレスポンシブにレイアウトを適応させること

### Requirement 9: アクセシビリティ・パフォーマンス基準

**User Story:** アクセシビリティニーズを持つユーザーとして、支援技術を使用してフェリー情報システムを利用したい。独立して旅行情報にアクセスするため。

#### Acceptance Criteria

1. WHEN スクリーンリーダーを使用するとき THEN システムは適切な ARIA ラベルとセマンティックマークアップを提供すること
2. WHEN キーボードでナビゲートするとき THEN システムは視覚的なフォーカスインジケーターを持つ完全なキーボードナビゲーションをサポートすること
3. WHEN ページを読み込むとき THEN システムはパフォーマンスとアクセシビリティで Lighthouse スコア 90+を達成すること
4. WHEN コンテンツを表示するとき THEN システムは色のコントラストとテキストサイズで WCAG 2.1 AA 準拠を維持すること
5. WHEN エラーが発生したとき THEN システムは回復提案を含む明確でアクセシブルなエラーメッセージを提供すること

### Requirement 10: インタラクティブ地図表示機能

**User Story:** 初めて隠岐諸島を訪れる旅行者として、港間の地理的関係と航路を地図上で視覚的に確認したい。島々の位置関係を理解して適切な航路を選択するため。

#### Acceptance Criteria

1. WHEN ユーザーが航路検索結果を表示するとき THEN システムは港の位置と航路を示すインタラクティブ地図を表示すること
2. WHEN ユーザーが地図上の港をクリックしたとき THEN システムはその港の詳細情報（名称、設備、アクセス情報）を表示すること
3. WHEN ユーザーが航路を地図上で選択したとき THEN システムは選択された航路をハイライト表示し、関連する時刻表情報を表示すること
4. WHEN 頻繁利用者がシンプルな表示を希望するとき THEN システムは地図表示の ON/OFF を切り替える設定を提供すること
5. WHEN モバイルデバイスで地図を表示するとき THEN システムはタッチジェスチャー（ピンチズーム、パン）をサポートすること

### Requirement 11: マルチプラットフォーム展開機能

**User Story:** ユーザーとして、Web ブラウザーと潜在的にネイティブモバイルアプリを通じてフェリー情報システムにアクセスしたい。好みのプラットフォームを使用するため。

#### Acceptance Criteria

1. WHEN Web に展開するとき THEN システムは HTTPS と CDN 配信を持つ Firebase Hosting でホストされること
2. WHEN モバイルアプリの準備をするとき THEN システムは iOS と Android 展開のための Capacitor と互換性があること
3. WHEN 異なるプラットフォーム経由でアクセスするとき THEN システムは一貫した機能とデータ同期を維持すること
4. WHEN システムを更新するとき THEN システムはサービス中断なしでシームレスな展開をサポートすること
5. WHEN 使用量をスケールするとき THEN システムは Firebase の自動スケーリングインフラストラクチャを通じて増加したトラフィックを処理すること
