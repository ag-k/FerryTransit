# 多言語対応機能仕様書

## 概要

隠岐航路案内の多言語対応機能は、日本語と英語の2言語をサポートし、ユーザーのロケール設定に応じて自動的に切り替える機能です。@nuxtjs/i18n を使用して実装されています。

## 対応言語

- **日本語（ja）**: デフォルト言語
- **英語（en）**: セカンダリ言語

## 実装方式

### i18n 設定

**設定ファイル**: `i18n.config.ts`

```typescript
export default defineI18nConfig(() => ({
  legacy: false,
  locale: 'ja',
  fallbackLocale: 'ja',
  messages: {
    ja: jaMessages,
    en: enMessages
  }
}))
```

### 翻訳ファイル

**日本語**: `i18n/locales/ja.json`
**英語**: `i18n/locales/en.json`

### 翻訳キーの構造

```json
{
  "PORTS": {
    "SAIGO": "西郷",
    "HISHIURA": "菱浦",
    "BEPPU": "別府",
    "KURI": "来居",
    "HONDO_SHICHIRUI": "七類",
    "HONDO_SAKAIMINATO": "境港"
  },
  "SHIPS": {
    "ISOKAZE": "いそかぜ",
    "FERRY_DOZEN": "フェリーどうぜん",
    "FERRY_OKI": "フェリーおき",
    "RAINBOWJET": "レインボージェット"
  },
  "ROUTE_SEARCH": "ルート検索",
  "TIMETABLE": "時刻表",
  "FARE": "運賃",
  "STATUS": "運航状況"
}
```

## 機能詳細

### 1. ロケールの切り替え

**ユーザー設定**
- 設定画面（`/settings`）から言語を選択
- ローカルストレージに保存
- アプリ全体に反映

**URL パス**
- 日本語: `/transit`, `/timetable` など
- 英語: `/en/transit`, `/en/timetable` など

### 2. 翻訳の使用

#### Composable: `useI18n`

```typescript
const { t, locale } = useI18n()

// 翻訳の取得
const portName = t('PORTS.SAIGO')  // "西郷" or "Saigo"

// ロケールの変更
locale.value = 'en'
```

#### テンプレート内での使用

```vue
<template>
  <h1>{{ $t('ROUTE_SEARCH') }}</h1>
  <p>{{ $t('PORTS.SAIGO') }}</p>
</template>
```

### 3. 動的パラメータ

```typescript
// 翻訳ファイル
{
  "WELCOME_MESSAGE": "こんにちは、{name}さん"
}

// 使用
t('WELCOME_MESSAGE', { name: '太郎' })  // "こんにちは、太郎さん"
```

### 4. 複数形の処理

```typescript
// 翻訳ファイル
{
  "ROUTE_COUNT": "{count}件のルートが見つかりました",
  "ROUTE_COUNT_0": "ルートが見つかりませんでした",
  "ROUTE_COUNT_1": "1件のルートが見つかりました"
}

// 使用
t('ROUTE_COUNT', { count: 5 })  // "5件のルートが見つかりました"
```

### 5. 日付・時刻のフォーマット

```typescript
const { d, n } = useI18n()

// 日付のフォーマット
d(new Date(), 'short')  // "2024/01/15" or "Jan 15, 2024"

// 数値のフォーマット
n(1234.56)  // "1,234.56" or "1,234.56"
```

## 翻訳対象

### 1. UI要素

- ボタン、リンク、ラベル
- エラーメッセージ、成功メッセージ
- フォームの入力項目
- ナビゲーションメニュー

### 2. データコンテンツ

- 港名
- 船舶名
- お知らせのタイトル・本文
- アラートの概要・コメント

### 3. メタデータ

- ページタイトル
- メタディスクリプション
- SEO用のテキスト

## 実装詳細

### Store: `useSettingsStore`

```typescript
export const useSettingsStore = defineStore('settings', {
  state: () => ({
    language: 'ja' as 'ja' | 'en'
  }),
  
  actions: {
    setLanguage(language: 'ja' | 'en') {
      this.language = language
      // i18n のロケールも更新
      const { locale } = useI18n()
      locale.value = language
      this.saveToLocalStorage()
    }
  }
})
```

### ミドルウェア: ロケール検出

```typescript
export default defineNuxtRouteMiddleware((to) => {
  const { locale } = useI18n()
  
  // URL からロケールを検出
  const pathLocale = to.path.split('/')[1]
  if (pathLocale === 'ja' || pathLocale === 'en') {
    locale.value = pathLocale
  }
})
```

## パフォーマンス最適化

1. **遅延読み込み**
   - 必要な言語の翻訳ファイルのみ読み込み
   - コード分割によるバンドルサイズの削減

2. **キャッシュ**
   - 翻訳ファイルをブラウザにキャッシュ
   - ローカルストレージに保存

## エラーハンドリング

- 翻訳キーが見つからない場合：キー名をそのまま表示
- 翻訳ファイルの読み込みエラー：フォールバックロケール（日本語）を使用

## 開発時の注意事項

1. **翻訳キーの命名規則**
   - 大文字とアンダースコアを使用
   - 階層構造を活用（例: `PORTS.SAIGO`）

2. **翻訳の追加**
   - 新しい翻訳キーを追加する場合は、日本語と英語の両方に追加
   - 未翻訳のキーは日本語を表示

3. **翻訳の確認**
   - すべての画面で両言語を確認
   - 長いテキストのレイアウト崩れを確認

## 関連機能

- **設定機能**: ユーザーが言語を選択
- **お知らせ機能**: 多言語対応のコンテンツ
- **アラート機能**: 多言語対応のメッセージ





