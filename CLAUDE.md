# CLAUDE.md

このファイルは、このリポジトリでコードを扱う際のClaude Code (claude.ai/code)への指針を提供します。

## プロジェクト概要

FerryTransitは、島根県隠岐諸島のフェリー時刻表と航路情報システムです。このアプリケーションは各港間のフェリースケジュールを表示し、日本語と英語の両方をサポートしています。

## 技術スタック

- **フロントエンド**: AngularJS 1.7.9 (レガシーバージョン)
- **言語**: TypeScript (ES5にコンパイル)
- **UI**: Bootstrap 3.4.1 with Angular UI Bootstrap
- **データストレージ**: SQLiteデータベースからJSONにエクスポート
- **サーバー**: CORSヘッダー付きでJSONを提供するPHP

## 開発コマンド

npmスクリプトが定義されていないため、開発は手動プロセスに従います：

### TypeScriptコンパイル
TypeScriptファイルは保存時にコンパイルするよう設定されています。プロジェクトで使用：
- `js/controller.ts` → `js/controller.js`
- `js/timepicker-ctrl.ts` → `js/timepicker-ctrl.js`

### データ更新
フェリー時刻表データを更新するには：
```bash
# update_timetable.sqlでSQLコマンドを編集
# 更新スクリプトを実行
./update_timetable.sh
```

更新プロセス：
1. CSVデータをSQLiteデータベースにインポート
2. データを`timetable.json`にエクスポート
3. PHPエンドポイントがこのJSONファイルを提供

## アーキテクチャ概要

### データフロー
1. **ソースデータ**: `timetable.sqlite`に保存されたフェリースケジュール情報
2. **データエクスポート**: `update_timetable.sh`経由でSQLite → JSON
3. **API**: `timetable.php`がCORSヘッダー付きでJSONを提供
4. **フロントエンド**: AngularJSコントローラーがデータを取得して表示

### コアコンポーネント

**メインコントローラー (`js/controller.ts`)**
- フェリースケジュール表示を管理
- 言語切り替え（ja/en）を処理
- 日付ベースのフィルタリングを実装
- 港/船情報のモーダルダイアログを制御

**データ構造**
時刻表データには以下が含まれます：
- 港の接続（西郷、菱浦、別府、来居、本土七類、本土境港）
- フェリーサービス（フェリーおき、フェリーしらしま、フェリーくにが、フェリーどうぜん）
- 日時付きスケジュール情報
- サービスアラートと例外

### 主要機能の実装
- **多言語対応**: コントローラー内の言語ファイルでAngular Translateを使用
- **日付フィルタリング**: スケジュールフィルタリング用のカスタム日付ピッカー実装
- **地図統合**: 港の場所を表示するGoogle Maps API
- **レスポンシブデザイン**: モバイル互換性のためのBootstrapベースのレイアウト

## 重要な考慮事項

1. **レガシーフレームワーク**: アクティブにメンテナンスされていないAngularJS 1.xを使用
2. **手動データ更新**: スケジュール更新には手動のSQL編集とスクリプト実行が必要
3. **CORS設定**: PHPエンドポイントにはクロスオリジンリクエスト用のCORSヘッダーが含まれる
4. **日付処理**: 日本のカレンダーの考慮事項とタイムゾーン処理が重要